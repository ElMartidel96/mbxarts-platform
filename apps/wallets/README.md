# CryptoGift Wallets - Regala el Futuro ğŸ

Una plataforma revolucionaria para crear y regalar NFT-wallets con criptomonedas reales usando tecnologÃ­a ERC-6551 (Token Bound Accounts).

## ğŸŒŸ CaracterÃ­sticas Principales

- **ğŸ Transferencia AutomÃ¡tica**: El destinatario se convierte en dueÃ±o real del NFT automÃ¡ticamente
- **ğŸ¤– Zero Custodia Humana**: Sistema programÃ¡tico sin regulaciones de custody
- **ğŸ’¼ NFT = Wallet**: Cada NFT tiene una wallet integrada que puede guardar criptomonedas reales
- **ğŸ¨ Arte IA**: Filtros de inteligencia artificial para crear arte Ãºnico
- **â›½ Gas Gratis**: Todas las transacciones estÃ¡n patrocinadas por Paymaster
- **ğŸ›¡ï¸ RecuperaciÃ³n Social**: Sistema de guardianes para recuperar acceso
- **ğŸ”„ Swaps Integrados**: Cambio entre diferentes criptomonedas con 0x Protocol
- **ğŸ’° Programa de Referidos**: Gana dinero invitando amigos
- **ğŸ” Transparencia Total**: Reservas auditables on-chain en tiempo real
- **ğŸ“± Mobile-First UX**: Experience optimizada para dispositivos mÃ³viles
- **ğŸ”— Deeplink Authentication**: IntegraciÃ³n perfecta con MetaMask mobile
- **ğŸ–¼ï¸ Dynamic Image Layouts**: Ajuste automÃ¡tico de imÃ¡genes verticales/horizontales
- **ğŸŒ Multi-Gateway IPFS**: Sistema de respaldo triple para mÃ¡xima disponibilidad
- **ğŸ“ Sistema de EducaciÃ³n**: Pre-claim education con mÃ³dulos interactivos y certificaciÃ³n
- **ğŸ” EIP-712 Approvals**: Stateless signature verification con gas < 30k
- **ğŸ“š 5 MÃ³dulos Educativos**: Desde wallet security hasta proyecto collaboration

### ğŸš€ **BREAKTHROUGH: Programmatic NFT Ownership Transfer**

```mermaid
graph TD
    A[Usuario crea regalo] --> B[NFT minted a direcciÃ³n neutral]
    B --> C[Metadata tracks creador original]
    C --> D[Destinatario recibe link]
    D --> E[Destinatario hace claim]
    E --> F[Transferencia automÃ¡tica via safeTransferFrom]
    F --> G[Destinatario = DueÃ±o real del NFT]
```

## ğŸš€ Demo & Estado Actual

- **Web App**: [https://cryptogift-wallets.vercel.app](https://cryptogift-wallets.vercel.app) âœ… **LIVE**
- **Contratos**: Desplegados en Base Sepolia âœ… **OPERATIVOS** 
- **Dashboard**: Panel de transparencia con estadÃ­sticas en vivo âœ… **FUNCIONAL**

### ğŸ¯ **ESTADO ACTUAL (Agosto 27, 2025):**

#### ğŸ“ **LATEST: EDUCATIONAL FLOW CRITICAL FIXES** âœ…
- âœ… **EMAIL VERIFICATION**: Fixed Redis JSON parsing error (500 Internal Server Error resolved)
- âœ… **CONNECTBUTTON VISIBILITY**: Proper state management ensures button appears after education
- âœ… **INFINITE RE-RENDERS ELIMINATED**: Removed circular dependency in SalesMasterclass
- âœ… **EIP-712 FLOW RESTORED**: Signature generation works after wallet connection
- âœ… **COMPLETE FLOW**: checkboxes â†’ success â†’ wallet â†’ EIP-712 â†’ claim

#### ğŸš€ **PREVIOUS: WALLET DASHBOARD AUDIT & ROBUST GAS-PAID FALLBACK** âœ…
- âœ… **DEEP SYSTEM AUDIT**: Fixed 30+ CSP blocking errors, corrected function selectors
- âœ… **GAS-PAID PRIMARY METHOD**: 100% functional as main transaction method
- âœ… **AUTO-DETECTION BICONOMY**: Runtime validation with automatic fallback

#### ğŸ“Š **PREVIOUS: CRITICAL MOBILE & UX FIXES** (Agosto 23, 2025) âœ…
- âœ… **MOBILE IPFS UPLOADS FIXED**: Exponential backoff retry (2sâ†’4sâ†’8s) para uploads exitosos en primer intento
- âœ… **DAO SHOWCASE UNIFIED**: Sales Masterclass con celebraciÃ³n comunitaria en PreClaim y Knowledge
- âœ… **THEME TOGGLE FIX**: Cambio de tema sin redirecciÃ³n a pÃ¡gina de inicio

#### ğŸ“ **PREVIOUS: UNIFIED EDUCATION SYSTEM + CRITICAL FIXES DEPLOYED** âœ…
- âœ… **UNIFIED KNOWLEDGE â†” EDUCATIONAL SYSTEM**: Same Sales Masterclass usado en ambos contextos sin duplicaciÃ³n
- âœ… **LESSON MODAL WRAPPER**: Modal universal con estructura GiftWizard para educaciÃ³n
- âœ… **AUTOMATIC LESSON REGISTRY**: Nuevas lecciones en Knowledge automÃ¡ticamente disponibles en Educational Requirements
- âœ… **CRITICAL EDUCATION BUGS FIXED**: Claimer field, wallet connection timing, silent gateData fallbacks
- âœ… **CONFETTI CELEBRATION PERFECTED**: Sistema de celebraciÃ³n mejorado que funciona en ambos modos
- âœ… **MOBILE EDUCATION COMPATIBILITY**: Workflow completo mobile-ready con error handling robusto
- ğŸ¯ **EDUCATION COMPLETION VERIFIED**: Flow completo de password â†’ education â†’ EIP-712 â†’ claim funcional

#### ğŸš¨ **PREVIOUS: MOBILE CLAIMING CRISIS RESOLVED** âœ…
- âœ… **CRITICAL MOBILE FIX**: "Error de conexiÃ³n" en mobile claims completamente resuelto
- âœ… **NFT IMAGE PARITY**: Mobile-claimed NFTs ahora muestran imÃ¡genes reales (no placeholders)
- âœ… **REDIS METADATA SYNC**: Frontend claims ahora actualizan Redis automÃ¡ticamente
- âœ… **TYPESCRIPT CLEAN**: Compilation errors resolved, deployment ready
- âœ… **PC COMPATIBILITY**: Zero impact on existing PC functionality (que ya funcionaba perfecto)
- ğŸ¯ **ROOT CAUSE FIXED**: Frontend vs Backend claim execution path unification completed

#### ğŸ”„ **COMPREHENSIVE PLATFORM STATUS:**
- âœ… **MOBILE UX PERFECTION** - Comprehensive mobile experience optimization  
- âœ… **R1: DEEPLINK AUTHENTICATION** - MetaMask mobile automatic deeplink system
- âœ… **R2: NFT VISIBILITY ENHANCED** - Pre-pinning with instant MetaMask display
- âœ… **R3: SPANISH ERROR MESSAGES** - Corrected multilingual error interface
- âœ… **R4: VERTICAL IMAGE LAYOUTS** - ResizeObserver dynamic adjustment system
- âœ… **R5: AUTO THEME + ZOOM COMPENSATION** - Desktop scaling for optimal viewing
- âœ… **R6: IPFS GATEWAY RETRY SYSTEM** - Triple-gateway fallback with telemetry
- âœ… **EDUCATION GATE SYSTEM** - Pre-claim education with EIP-712 approvals
- âœ… **BASESCAN COMPATIBILITY** - NFT images display in block explorers
- âœ… **METAMASK COMPATIBILITY** - NFT images display properly in wallets
- âœ… **PRODUCTION STABILITY** - Critical runtime errors resolved
- âœ… **CI/CD COMPLIANCE** - All hardcodes eliminated, scripts secure
- âœ… **SECURITY HARDENING COMPLETED** - All critical vulnerabilities patched
- âœ… **PERFORMANCE OPTIMIZED** - 99% RPC reduction with persistent mapping
- âœ… **BUILD FIXES APPLIED** - All compilation errors resolved
- âœ… **SISTEMA CORE COMPLETADO** - NFT ownership transfer automÃ¡tico 
- âœ… **ZERO CUSTODIA HUMANA** - Transferencia programÃ¡tica sin regulaciones
- âœ… **ESCROW TEMPORAL** - Password-based gifts with auto-expiration
- âœ… **IGate COMPLIANCE** - SimpleApprovalGate deployed and verified on Base Sepolia
- ğŸš€ **FASE ACTUAL**: Production-ready education system with enterprise-grade security

## ğŸ› ï¸ TecnologÃ­a

### Frontend
- **Next.js 15** - Framework React
- **ThirdWeb v5** - Web3 SDK con Account Abstraction
- **Tailwind CSS** - Styling con design tokens
- **TypeScript** - Type safety
- **Framer Motion** - Animaciones spring physics estÃ¡ndar

### Blockchain
- **Base Sepolia** - Layer 2 para transacciones rÃ¡pidas y baratas
- **ERC-6551** - Token Bound Accounts
- **Account Abstraction** - UX simplificada con Paymaster
- **OpenZeppelin** - Contratos seguros y auditados

### APIs e Integraciones
- **PhotoRoom API v2** - Filtros IA para imÃ¡genes
- **0x Protocol v2** - Swaps descentralizados
- **NFT.Storage** - Almacenamiento IPFS
- **Vercel KV** - Rate limiting y session management
- **Upstash Redis** - Education progress tracking
- **Telegram Bot** - Alertas de monitoreo
- **SimpleApprovalGate** - IGate contract para pre-claim education

## ğŸ“¦ InstalaciÃ³n

### Prerrequisitos
- Node.js 18+
- npm o yarn
- Wallet con fondos en Base Sepolia

### 1. Clonar el repositorio
```bash
git clone https://github.com/your-username/cryptogift-wallets.git
cd cryptogift-wallets
```

### 2. Instalar dependencias
```bash
cd frontend
npm install

# Instalar dependencias de Hardhat
cd ..
npm install
```

### 3. Configurar variables de entorno
```bash
cp .env.example .env.local
```

Edita `.env.local` con tus claves:
```env
# ThirdWeb (REQUERIDO)
NEXT_PUBLIC_TW_CLIENT_ID=your_thirdweb_client_id
TW_SECRET_KEY=your_thirdweb_secret_key

# Contratos en Base Sepolia (REQUERIDO)
NEXT_PUBLIC_CRYPTOGIFT_NFT_ADDRESS=0x_your_deployed_contract_address
NEXT_PUBLIC_ERC6551_REGISTRY_ADDRESS=0x000000006551c19487814612e58FE06813775758
NEXT_PUBLIC_ERC6551_IMPLEMENTATION_ADDRESS=0x2d25602551487c3f3354dd80d76d54383a243358

# Education System - SimpleApprovalGate (REQUERIDO)
NEXT_PUBLIC_SIMPLE_APPROVAL_GATE_ADDRESS=0x99cCBE808cf4c01382779755DEf1562905ceb0d2
APPROVER_PRIVATE_KEY=your_approver_private_key
APPROVER_ADDRESS=0x75e32B5BA0817fEF917f21902EC5a84005d00943

# Education System Configuration
EDUCATION_PASSWORD_ATTEMPTS_LIMIT=5
EDUCATION_SESSION_TTL=3600
EDUCATION_SIGNATURE_TTL=3600

# Redis/KV para sesiones y rate limiting (REQUERIDO)
UPSTASH_REDIS_REST_URL=your_upstash_redis_url
UPSTASH_REDIS_REST_TOKEN=your_upstash_redis_token
JWT_SECRET=your_jwt_secret_key

# NFT Storage (REQUERIDO)
NFT_STORAGE_API_KEY=your_nft_storage_api_key

# Opcional - Para funcionalidades avanzadas
PHOTOROOM_KEY=tu_clave_photoroom_aqui
TELEGRAM_TOKEN=tu_bot_token_aqui
```

### 4. Desplegar contratos (opcional)
```bash
# Compilar contratos
npx hardhat compile

# Desplegar en Base Sepolia
npx hardhat run scripts/deploy.ts --network base-sepolia
```

### 5. Ejecutar en desarrollo
```bash
cd frontend
npm run dev
```

La aplicaciÃ³n estarÃ¡ disponible en `http://localhost:3000`

## ğŸ—ï¸ Arquitectura

### Contratos Inteligentes
```
contracts/
â”œâ”€â”€ ReferralTreasury.sol    # Sistema de comisiones
â””â”€â”€ (NFT Drop via ThirdWeb) # Mint de NFTs
```

### Frontend
```
frontend/src/
â”œâ”€â”€ app/                    # App Router de Next.js
â”‚   â”œâ”€â”€ page.tsx           # PÃ¡gina principal
â”‚   â”œâ”€â”€ token/[...]/       # PÃ¡gina de wallet NFT
â”‚   â”œâ”€â”€ knowledge/         # Sistema educativo completo
â”‚   â””â”€â”€ referrals/         # Panel de referidos
â”œâ”€â”€ components/            # Componentes React
â”‚   â”œâ”€â”€ learn/             # ğŸ“ SISTEMA UX MASTER
â”‚   â”‚   â””â”€â”€ LearningPath.tsx # â­ COMPONENTE PATRÃ“N UX
â”‚   â”œâ”€â”€ GiftWizard.tsx     # Wizard de creaciÃ³n
â”‚   â”œâ”€â”€ WalletInterface.tsx # Interfaz de wallet
â”‚   â””â”€â”€ SwapModal.tsx      # Modal de swaps
â”œâ”€â”€ pages/api/             # API Routes
â”‚   â”œâ”€â”€ mint.ts            # Mint de NFTs
â”‚   â”œâ”€â”€ swap.ts            # 0x Protocol
â”‚   â””â”€â”€ upload.ts          # IPFS upload
â””â”€â”€ lib/                   # Utilidades
    â”œâ”€â”€ constants.ts       # Configuraciones
    â””â”€â”€ errorHandler.ts    # Manejo de errores
```

### ğŸ¨ EstÃ¡ndares de DiseÃ±o UX

El proyecto sigue **estÃ¡ndares obligatorios de UX** documentados en:
- `UX_DESIGN_STANDARDS.md` - Patrones de diseÃ±o oficial
- `components/learn/LearningPath.tsx` - Componente patrÃ³n maestro
- `app/knowledge/page.tsx` - ImplementaciÃ³n de referencia

#### Principios UX Obligatorios:
- **Hover/Touch System**: Sin botones feos, interacciÃ³n natural
- **Click Outside to Close**: UX sin interrupciones
- **Spring Physics**: stiffness: 300, damping: 25 (estÃ¡ndar)
- **Glass Morphism**: backdrop-blur-xl + transparencias
- **Mobile-First**: Touch events = Mouse events

## ğŸ”§ ConfiguraciÃ³n Avanzada

### Paymaster (Gas Gratis)
El Paymaster estÃ¡ configurado automÃ¡ticamente con ThirdWeb. Para monitorear el balance:
```bash
# Configurar alertas
chmod +x cron-setup.sh
./cron-setup.sh
```

### Rate Limiting
Configurar Vercel KV para protecciÃ³n anti-spam:
```env
VERCEL_KV_URL=redis://...
VERCEL_KV_REST_API_URL=https://...
VERCEL_KV_REST_API_TOKEN=...
```

### Filtros IA (PhotoRoom)
Para habilitar filtros de IA:
1. Registrarse en [PhotoRoom](https://photoroom.com/api)
2. Obtener API key
3. AÃ±adir `PHOTOROOM_KEY` al `.env.local`

## ğŸš€ Deployment

### Vercel (Recomendado)
```bash
# Instalar Vercel CLI
npm i -g vercel

# Configurar secrets
vercel env add NEXT_PUBLIC_TW_CLIENT_ID
vercel env add TW_SECRET_KEY
vercel env add NFT_STORAGE_API_KEY
# ... (aÃ±adir todas las variables necesarias)

# Deploy
vercel --prod
```

### Variables de Entorno en Vercel
AsegÃºrate de configurar todas las variables de entorno en el dashboard de Vercel:
- `NEXT_PUBLIC_*` variables (pÃºblicas)
- `TW_SECRET_KEY` (privada)
- `NFT_STORAGE_API_KEY` (privada)
- Otras claves sensibles

## ğŸ§ª Testing

### Tests Locales
```bash
# Unit tests
npm run test

# Type checking
npm run type-check

# Linting
npm run lint
```

### Tests de Contratos
```bash
# Tests con Hardhat
npx hardhat test

# Coverage
npx hardhat coverage
```

## ğŸ“Š Monitoreo

### Dashboard de Transparencia
- **Reservas Totales**: Fondos almacenados on-chain
- **Paymaster Balance**: Gas disponible
- **Transacciones**: Actividad en tiempo real
- **Referidos**: EstadÃ­sticas del programa

### Alertas AutomÃ¡ticas
- Balance bajo del Paymaster
- Errores en APIs
- Transacciones fallidas

## ğŸ”’ Seguridad

### AuditorÃ­as
- Contratos basados en OpenZeppelin
- Rate limiting implementado
- ValidaciÃ³n de entrada en todas las APIs
- Manejo seguro de claves privadas

### Mejores PrÃ¡cticas
- Nunca commits claves privadas
- Usar variables de entorno para secrets
- Validar todas las entradas del usuario
- Implementar timeouts en APIs externas

## ğŸ¤ Contribuir

1. Fork el proyecto
2. Crear una rama feature (`git checkout -b feature/AmazingFeature`)
3. Commit los cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abrir un Pull Request

## ğŸ“ Roadmap

### v1.1 - Mejoras UX
- [ ] Modo oscuro
- [ ] MÃºltiples idiomas
- [ ] Tutorial interactivo
- [ ] Notificaciones push

### v1.2 - Funcionalidades Avanzadas
- [ ] Generador de arte IA completo
- [ ] MÃºltiples blockchains
- [ ] Marketplace de NFT-wallets
- [ ] IntegraciÃ³n con redes sociales

### v2.0 - Escalabilidad
- [ ] TokenizaciÃ³n de activos reales
- [ ] API pÃºblica para developers
- [ ] White-label solution
- [ ] Mobile app nativa

## ğŸ“„ Licencia

MIT License - ver [LICENSE](LICENSE) para mÃ¡s detalles.

## ğŸš¨ Errores Conocidos y Soluciones

### **ERROR DE ZOOM DESKTOP** 
**SÃ­ntomas:** PÃ¡gina se ve mÃ¡s grande de lo normal, requiere 90% zoom del navegador para verse bien
**Causa RaÃ­z:** `X-Frame-Options: DENY` en headers de API endpoints interfiere con viewport
**SoluciÃ³n:** Cambiar `DENY` a `SAMEORIGIN` en endpoints de metadata
**Archivos Afectados:** `/api/nft-metadata/[contractAddress]/[tokenId].ts`
**Commit ProblemÃ¡tico:** 8e2c7e2 (August 8, 2025)
**Fix Aplicado:** a18f526 + este commit

```javascript
// âŒ PROBLEMÃTICO:
res.setHeader('X-Frame-Options', 'DENY');

// âœ… CORRECCIÃ“N:
res.setHeader('X-Frame-Options', 'SAMEORIGIN');
```

**DetecciÃ³n:** Si la pÃ¡gina requiere zoom <100% para verse normal, es este error.

---

## ğŸ†˜ Soporte

- **Discord**: [CryptoGift_Wallets_DAO](https://discord.gg/4zBvZnQB)
- **Farcaster**: [cryptogift-w](https://farcaster.xyz/cryptogift-w)
- **X/Twitter**: [@giftwalletcoin](https://x.com/giftwalletcoin?s=21)
- **YouTube**: [CryptoGift Channel](https://youtu.be/_CDc7GMVNhg)
- **Email**: admin@mbxart.com

## ğŸ’ CrÃ©ditos

**Â© 2025 The Moon in a Box, CryptoGift Wallets. All rights reserved.**

Desarrollado con â¤ï¸ por el equipo de CryptoGift Wallets

**TecnologÃ­as utilizadas:**
- [ThirdWeb](https://thirdweb.com) - Web3 Development Platform
- [Base](https://base.org) - Layer 2 Blockchain
- [0x Protocol](https://0x.org) - DEX Aggregation
- [PhotoRoom](https://photoroom.com) - AI Image Processing
- [NFT.Storage](https://nft.storage) - IPFS Storage
- [Vercel](https://vercel.com) - Deployment Platform

---

â­ **Â¡Dale una estrella si te gusta el proyecto!** â­