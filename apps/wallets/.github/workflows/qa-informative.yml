name: ðŸ“Š QA Report (Informative Only)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  qa-informative-report:
    name: ðŸ“‹ Quality Assurance Informational Report
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout Code
      uses: actions/checkout@v4
      
    - name: ðŸ“¦ Install pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 9.15.9
        run_install: false
        
    - name: ðŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        registry-url: 'https://registry.npmjs.org/'
        cache: 'pnpm'
        cache-dependency-path: pnpm-lock.yaml

    - name: ðŸ“¦ Install Dependencies
      run: |
        echo "ðŸ” Installing dependencies with pnpm $(pnpm --version)..."
        pnpm install --frozen-lockfile --prefer-offline
      continue-on-error: true
      env:
        NODE_AUTH_TOKEN: ${{ secrets.NODE_AUTH_TOKEN }}

    - name: ðŸ” TypeScript Analysis (Non-blocking)
      run: |
        cd frontend
        echo "## ðŸ” TypeScript Analysis Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if pnpm run type-check 2>&1 | tee typescript-output.txt; then
          echo "âœ… **TypeScript compilation successful**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **TypeScript errors found:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -20 typescript-output.txt >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
      continue-on-error: true

    - name: ðŸ§¹ ESLint Analysis (Non-blocking)
      run: |
        cd frontend
        echo "## ðŸ§¹ ESLint Analysis Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if pnpm run lint 2>&1 | tee eslint-output.txt; then
          echo "âœ… **ESLint validation successful**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **ESLint issues found:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -30 eslint-output.txt >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
      continue-on-error: true

    - name: ðŸ§ª Test Suite Analysis (Non-blocking)
      run: |
        cd frontend
        echo "## ðŸ§ª Test Suite Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if pnpm run test:coverage 2>&1 | tee test-output.txt; then
          echo "âœ… **Tests passed with coverage:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          grep -A 10 "All files" test-output.txt >> $GITHUB_STEP_SUMMARY || echo "Coverage details not found"
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Test failures detected:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -20 test-output.txt >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
      continue-on-error: true

    - name: ðŸ—ï¸ Build Analysis (Non-blocking)
      run: |
        cd frontend
        echo "## ðŸ—ï¸ Production Build Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if timeout 300 pnpm run build 2>&1 | tee build-output.txt; then
          echo "âœ… **Production build successful**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **Build errors detected:**" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          tail -30 build-output.txt >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
      continue-on-error: true

    - name: ðŸ“Š Generate Final QA Report
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸŽ¯ QA Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“… **Report Generated:** $(date -u)" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ”— **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "ðŸŒ¿ **Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âš ï¸ **Note:** This is an informational report only." >> $GITHUB_STEP_SUMMARY
        echo "Issues found do not block deployment but should be addressed." >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸŽ¯ **Next Steps:**" >> $GITHUB_STEP_SUMMARY
        echo "1. Review any errors or warnings above" >> $GITHUB_STEP_SUMMARY
        echo "2. Fix critical issues in next iteration" >> $GITHUB_STEP_SUMMARY
        echo "3. Deploy continues normally" >> $GITHUB_STEP_SUMMARY
      continue-on-error: true

    # Always succeed - never block deployment
    - name: âœ… Report Complete
      run: |
        echo "ðŸŽ‰ QA Report generated successfully!"
        echo "ðŸ“Š Check the Summary tab for detailed results"
        exit 0